module.exports=[47447,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(6704),f=a.i(25940),g=a.i(74248),h=a.i(5193),i=a.i(36121);let j=async()=>(await i.default.get("/chat/conversations/my-conversations")).data,k=async(a,b)=>(await i.default.post("/chat/messages/create",{conversationId:a,message:b})).data,l=async(a,b=0,c=50)=>(await i.default.get(`/chat/conversations/${a}/messages`,{params:{page:b,size:c}})).data,m=async a=>{try{return(await i.default.put(`/chat/conversations/mark-as-read?conversationId=${a}`,{})).data}catch{return null}};var n=a.i(47410),o=a.i(45222);let p=({conv:a,isSelected:c,unreadCount:d,onClick:e})=>(0,b.jsxs)("div",{onClick:e,className:`flex items-center gap-3 p-4 cursor-pointer hover:bg-gray-50 transition-all duration-200 ${c?"bg-gradient-to-r from-sky-50 to-blue-50 border-r-4 border-sky-500":""} ${d>0?"bg-sky-50/50":""}`,children:[(0,b.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,b.jsx)("img",{src:a.conversationAvatar||"https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_640.png",alt:"Avatar",className:"w-12 h-12 rounded-full object-cover border-2 border-white shadow-sm"}),d>0&&(0,b.jsx)("div",{className:"absolute -top-1 -right-1 min-w-[20px] h-5 flex items-center justify-center bg-gradient-to-r from-red-500 to-pink-500 text-white text-xs font-bold rounded-full px-1",children:d>99?"99+":d})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,b.jsx)("p",{className:`font-semibold text-gray-800 truncate ${d>0?"text-sky-800":""}`,children:a.conversationName||"Conversation"}),(0,b.jsx)("span",{className:"text-xs text-gray-400 flex-shrink-0 ml-2",children:(a=>{if(!a)return"";let b=new Date(a),c=Math.floor((new Date().getTime()-b.getTime())/1e3);return c<60?"Now":c<3600?`${Math.floor(c/60)}m`:c<86400?`${Math.floor(c/3600)}h`:b.toLocaleDateString()})(a.lastMessageTime)})]}),(0,b.jsx)("p",{className:`text-sm truncate ${d>0?"text-gray-700 font-medium":"text-gray-500"}`,children:a.lastMessage||"No messages yet"})]})]}),q=({conversations:a,selectedChat:d,onSelectChat:e,isLoading:f=!1,unreadByConversation:g={}})=>{let h=(0,c.useMemo)(()=>[...a].sort((a,b)=>{let c=g[a.id]||0,d=g[b.id]||0;if(c>0&&0===d)return -1;if(d>0&&0===c)return 1;let e=a.lastMessageTime?new Date(a.lastMessageTime).getTime():0;return(b.lastMessageTime?new Date(b.lastMessageTime).getTime():0)-e}),[a,g]);return f?(0,b.jsx)("div",{className:"flex-1 overflow-y-auto",children:Array.from({length:5}).map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-3 p-4 animate-pulse",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"h-4 bg-gray-200 rounded w-32 mb-2"}),(0,b.jsx)("div",{className:"h-3 bg-gray-100 rounded w-48"})]})]},`skeleton-${c}`))}):0===h.length?(0,b.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center p-6 text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 mb-4 rounded-full bg-gradient-to-br from-sky-100 to-blue-100 flex items-center justify-center",children:(0,b.jsx)(o.MessageCircle,{className:"w-8 h-8 text-sky-400"})}),(0,b.jsx)("h3",{className:"font-semibold text-gray-800 mb-1",children:"No conversations yet"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Start a conversation with someone!"})]}):(0,b.jsx)("div",{className:"flex-1 overflow-y-auto",children:h.map(a=>(0,b.jsx)(p,{conv:a,isSelected:d?.id===a.id,unreadCount:g[a.id]||0,onClick:()=>e(a)},a.id))})};var r=a.i(70106);let s=(0,r.default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),t=(0,r.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),u=(0,r.default)("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),v=({message:a,isOwn:c})=>{var d;let e=a.message||a.content||"";return(0,b.jsx)("div",{className:`flex ${c?"justify-end":"justify-start"}`,children:(0,b.jsxs)("div",{className:`max-w-[70%] px-4 py-2.5 rounded-2xl ${c?"bg-gradient-to-r from-sky-500 to-blue-500 text-white rounded-br-sm":"bg-white text-gray-800 shadow-sm border border-gray-100 rounded-bl-sm"}`,children:[(0,b.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:e}),(0,b.jsxs)("p",{className:`text-xs mt-1.5 ${c?"text-white/70":"text-gray-400"}`,children:[(d=a.createdDate||a.createdAt)?new Date(d).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",c&&a.read&&(0,b.jsx)("span",{className:"ml-2",children:"✓✓"})]})]})})},w=({conversation:a,messages:d,currentUserId:e,onSendMessage:f,isConnected:g=!1,loadingMessages:h=!1})=>{let[i,j]=(0,c.useState)(""),k=(0,c.useRef)(null);(0,c.useEffect)(()=>{k.current?.scrollIntoView({behavior:"smooth"})},[d]);let l=()=>{i.trim()&&(f(i.trim()),j(""))};return a?(0,b.jsxs)("div",{className:"flex-1 flex flex-col bg-gray-50",children:[(0,b.jsxs)("div",{className:"bg-white p-4 border-b flex items-center gap-3 shadow-sm",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("img",{src:a.conversationAvatar||"https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_640.png",alt:"Avatar",className:"w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm"}),g&&(0,b.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-semibold text-gray-800",children:a.conversationName||"Conversation"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:g?"Online":"Offline"})]})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[h?(0,b.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-sky-500 border-t-transparent rounded-full mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-gray-500 text-sm",children:"Loading messages..."})]})}):d.length>0?d.map(a=>(0,b.jsx)(v,{message:a,isOwn:a.senderId===e},a.id)):(0,b.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-gray-500",children:"No messages yet"}),(0,b.jsx)("p",{className:"text-gray-400 text-sm",children:"Start the conversation!"})]})}),(0,b.jsx)("div",{ref:k})]}),(0,b.jsx)("div",{className:"bg-white p-4 border-t",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{className:"p-2 hover:bg-gray-100 rounded-full transition-colors text-gray-500 hover:text-gray-700",children:(0,b.jsx)(t,{size:20})}),(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)("input",{type:"text",placeholder:"Type a message...",value:i,onChange:a=>j(a.target.value),onKeyPress:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),l())},className:"w-full px-4 py-3 pr-12 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all bg-gray-50"}),(0,b.jsx)("button",{className:"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 hover:bg-gray-100 rounded-full transition-colors text-gray-500 hover:text-gray-700",children:(0,b.jsx)(u,{size:18})})]}),(0,b.jsx)("button",{onClick:l,disabled:!i.trim(),className:"p-3 bg-gradient-to-r from-sky-500 to-blue-500 text-white rounded-full hover:from-sky-600 hover:to-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md hover:shadow-lg",children:(0,b.jsx)(s,{size:20})})]})})]}):(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center bg-gradient-to-b from-gray-50 to-white",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-br from-sky-100 to-blue-100 flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-12 h-12 text-sky-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,b.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"Select a conversation"}),(0,b.jsx)("p",{className:"text-gray-500 text-sm",children:"Choose a chat to start messaging"})]})})},x=(0,r.default)("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),y=(0,r.default)("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),z=({isConnected:a})=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:`w-2 h-2 rounded-full ${a?"bg-green-500":"bg-red-500"}`}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:a?"Connected":"Disconnected"}),a?(0,b.jsx)(x,{size:14,className:"text-green-500"}):(0,b.jsx)(y,{size:14,className:"text-red-500"})]});function A(){let[a,i]=(0,c.useState)([]),[o,p]=(0,c.useState)(null),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)(null),[v,x]=(0,c.useState)(!1),[y,A]=(0,c.useState)(!0),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)({}),H=(0,d.useRouter)(),{sendMessage:I,isConnected:J,registerMessageCallbacks:K}=(0,g.useSocket)(),{addNotification:L}=(0,h.useNotification)();(0,c.useEffect)(()=>{},[H]),(0,c.useEffect)(()=>{},[]),(0,c.useEffect)(()=>{(0,h.requestNotificationPermission)()},[]),(0,c.useEffect)(()=>{u((0,f.getUserId)())},[]);let M=(0,c.useCallback)(async()=>{try{A(!0);let a=(await j()||[]).sort((a,b)=>{let c=a.lastMessageTime?new Date(a.lastMessageTime).getTime():0;return(b.lastMessageTime?new Date(b.lastMessageTime).getTime():0)-c});i(a)}catch(a){console.error("Error fetching conversations:",a),e.default.error("Không thể tải danh sách trò chuyện")}finally{A(!1)}},[]);(0,c.useEffect)(()=>{(0,f.getToken)()&&M()},[M]);let N=(0,c.useCallback)(async a=>{try{x(!0);let b=await l(a,0,50),c=b?.content||[];s(c.reverse()),await m(a),G(b=>({...b,[a]:0}))}catch(a){console.error("Error fetching messages:",a)}finally{x(!1)}},[]);(0,c.useEffect)(()=>{K&&K({onMessageReceived:a=>{o&&a.conversationId===o.id?s(b=>[...b,a]):G(b=>({...b,[a.conversationId||""]:(b[a.conversationId||""]||0)+1})),M()},onMessageSent:a=>{s(b=>[...b,a])}})},[K,o,M]);let O=async a=>{if(a.trim()&&o?.id)try{I({conversationId:o.id,message:a})||(await k(o.id,a),N(o.id))}catch(a){console.error("Error sending message:",a),e.default.error("Không thể gửi tin nhắn")}};return(0,b.jsxs)("div",{className:"flex min-h-screen",children:[B&&(0,b.jsx)("button",{onClick:()=>E(!D),className:"fixed top-4 left-4 z-50 p-2 bg-white rounded-md shadow-md border md:hidden","aria-label":"Toggle menu",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:D?(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),B&&D&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden",onClick:()=>E(!1)}),(0,b.jsx)("div",{className:"hidden md:block w-[240px] h-screen bg-white border-r flex-shrink-0",children:(0,b.jsx)(n.SidebarComponent,{})}),(0,b.jsx)("div",{className:`
                    md:hidden fixed top-0 left-0 w-64 h-screen bg-white border-r z-50
                    transition-transform duration-300 ease-in-out
                    ${D?"translate-x-0":"-translate-x-full"}
                `,children:(0,b.jsx)(n.SidebarComponent,{})}),(0,b.jsx)("div",{className:`flex-1 min-h-screen w-full max-w-full overflow-hidden ${B?"pt-16":""}`,children:(0,b.jsxs)("div",{className:"flex h-screen",children:[(0,b.jsxs)("div",{className:"w-80 bg-white border-r flex flex-col",children:[(0,b.jsxs)("div",{className:"p-4 border-b",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"Messages"}),(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)(z,{isConnected:J})})]}),(0,b.jsx)(q,{conversations:a,selectedChat:o,onSelectChat:a=>{p(a),a.id&&N(a.id)},isLoading:y,unreadByConversation:F})]}),(0,b.jsx)(w,{conversation:o,messages:r,currentUserId:t,onSendMessage:O,isConnected:J,loadingMessages:v})]})})]})}a.s(["default",()=>A],47447)}];

//# sourceMappingURL=src_app_message_page_tsx_1579e1d3._.js.map