{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/neuro/Documents/Blur/frontend/src/lib/utils/constants.ts"],"sourcesContent":["export const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:8888/api'\nexport const API_BASE = process.env.NEXT_PUBLIC_CHAT_API || 'http://localhost:8888/api/chat'\nexport const PROFILE_API = process.env.NEXT_PUBLIC_PROFILE_API || 'http://localhost:8888/api/profile'\nexport const SOCKET_URL = process.env.NEXT_PUBLIC_SOCKET_URL || 'http://localhost:8099'\nexport const AI_API = process.env.NEXT_PUBLIC_AI_API || 'http://localhost:9090'\n"],"names":[],"mappings":";;;;;;;;;;;;AAA4B;AAArB,MAAM,eAAe,iEAAwC;AAC7D,MAAM,WAAW,sEAAoC;AACrD,MAAM,cAAc,yEAAuC;AAC3D,MAAM,aAAa,6DAAsC;AACzD,MAAM,SAAS,6DAAkC"}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"sources":["file:///home/neuro/Documents/Blur/frontend/src/lib/utils/auth.ts"],"sourcesContent":["export const getToken = (): string | null => {\n    if (typeof window === 'undefined') return null\n    return localStorage.getItem(\"token\")\n}\n\nexport const setToken = (token: string): void => {\n    if (typeof window !== 'undefined') {\n        localStorage.setItem(\"token\", token)\n    }\n}\n\nexport const removeToken = (): void => {\n    if (typeof window !== 'undefined') {\n        localStorage.removeItem(\"token\")\n    }\n}\n\ninterface DecodedToken {\n    sub?: string\n    userId?: string\n    user_id?: string\n    id?: string\n}\n\nexport const getUserId = (): string | null => {\n    const token = getToken()\n    if (!token) return null\n\n    try {\n        const payload = token.split('.')[1]\n        const decoded: DecodedToken = JSON.parse(atob(payload))\n        return decoded.sub || decoded.userId || decoded.user_id || decoded.id || null\n    } catch (error) {\n        console.error(\"Cannot decode token:\", error)\n        return null\n    }\n}\n\nexport const isAuthenticated = (): boolean => {\n    return !!getToken()\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAO,MAAM,WAAW;IACpB;;IACA,OAAO,aAAa,OAAO,CAAC;AAChC;AAEO,MAAM,WAAW,CAAC;IACrB,wCAAmC;QAC/B,aAAa,OAAO,CAAC,SAAS;IAClC;AACJ;AAEO,MAAM,cAAc;IACvB,wCAAmC;QAC/B,aAAa,UAAU,CAAC;IAC5B;AACJ;AASO,MAAM,YAAY;IACrB,MAAM,QAAQ;IACd,IAAI,CAAC,OAAO,OAAO;IAEnB,IAAI;QACA,MAAM,UAAU,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE;QACnC,MAAM,UAAwB,KAAK,KAAK,CAAC,KAAK;QAC9C,OAAO,QAAQ,GAAG,IAAI,QAAQ,MAAM,IAAI,QAAQ,OAAO,IAAI,QAAQ,EAAE,IAAI;IAC7E,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO;IACX;AACJ;AAEO,MAAM,kBAAkB;IAC3B,OAAO,CAAC,CAAC;AACb"}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///home/neuro/Documents/Blur/frontend/src/contexts/SocketContext.tsx"],"sourcesContent":["'use client'\n\nimport React, { createContext, useContext, useEffect, useRef, useState, useCallback, useMemo, ReactNode } from \"react\"\nimport { SOCKET_URL } from \"@/lib/utils/constants\"\nimport { getToken } from \"@/lib/utils/auth\"\n\n// Extend Window interface for Socket.IO\ndeclare global {\n    interface Window {\n        io: (url: string, options: Record<string, unknown>) => SocketType\n    }\n}\n\ninterface SocketType {\n    on: (event: string, callback: (data?: unknown) => void) => void\n    off: (event: string) => void\n    emit: (event: string, data?: unknown) => void\n    disconnect: () => void\n}\n\ninterface MessageCallbacks {\n    onMessageSent: ((data: unknown) => void) | null\n    onMessageReceived: ((data: unknown) => void) | null\n}\n\ninterface CallCallbacks {\n    onCallInitiated: ((data: unknown) => void) | null\n    onIncomingCall: ((data: unknown) => void) | null\n    onCallAnswered: ((data: unknown) => void) | null\n    onCallRejected: ((data: unknown) => void) | null\n    onCallEnded: ((data: unknown) => void) | null\n    onCallFailed: ((data: unknown) => void) | null\n    onWebRTCOffer: ((data: unknown) => void) | null\n    onWebRTCAnswer: ((data: unknown) => void) | null\n    onICECandidate: ((data: unknown) => void) | null\n}\n\ninterface SocketContextValue {\n    socket: SocketType | null\n    isConnected: boolean\n    error: string\n    sendMessage: (messageData: unknown) => boolean\n    sendTypingIndicator: (conversationId: string, isTyping: boolean) => void\n    registerMessageCallbacks: (callbacks: Partial<MessageCallbacks>) => void\n    initiateCall: (callData: unknown) => boolean\n    answerCall: (callId: string) => boolean\n    rejectCall: (callId: string) => boolean\n    endCall: (callId: string) => boolean\n    sendWebRTCOffer: (toUserId: string, offer: unknown) => boolean\n    sendWebRTCAnswer: (toUserId: string, answer: unknown) => boolean\n    sendICECandidate: (toUserId: string, candidate: unknown) => boolean\n    registerCallCallbacks: (callbacks: Partial<CallCallbacks>) => void\n}\n\ninterface SocketProviderProps {\n    children: ReactNode\n}\n\nconst SocketContext = createContext<SocketContextValue | null>(null)\n\nexport const SocketProvider: React.FC<SocketProviderProps> = ({ children }) => {\n    const socketRef = useRef<SocketType | null>(null)\n    const [isConnected, setIsConnected] = useState(false)\n    const [error, setError] = useState(\"\")\n\n    const messageCallbacksRef = useRef<MessageCallbacks>({\n        onMessageSent: null,\n        onMessageReceived: null,\n    })\n\n    const callCallbacksRef = useRef<CallCallbacks>({\n        onCallInitiated: null,\n        onIncomingCall: null,\n        onCallAnswered: null,\n        onCallRejected: null,\n        onCallEnded: null,\n        onCallFailed: null,\n        onWebRTCOffer: null,\n        onWebRTCAnswer: null,\n        onICECandidate: null,\n    })\n\n    const registerMessageCallbacks = useCallback((callbacks: Partial<MessageCallbacks>) => {\n        messageCallbacksRef.current = {\n            ...messageCallbacksRef.current,\n            ...callbacks\n        }\n    }, [])\n\n    const registerCallCallbacks = useCallback((callbacks: Partial<CallCallbacks>) => {\n        const hasChanged = Object.keys(callbacks).some(key =>\n            callCallbacksRef.current[key as keyof CallCallbacks] !== callbacks[key as keyof CallCallbacks]\n        )\n\n        if (!hasChanged) {\n            return\n        }\n\n        callCallbacksRef.current = {\n            ...callCallbacksRef.current,\n            ...callbacks\n        }\n    }, [])\n\n    useEffect(() => {\n        if (typeof window === 'undefined') return\n\n        const token = getToken()\n        if (!token) {\n            return\n        }\n\n        const script = document.createElement(\"script\")\n        script.src = \"https://cdn.socket.io/4.5.4/socket.io.min.js\"\n        script.async = true\n\n        script.onload = () => {\n            if (socketRef.current) {\n                return\n            }\n            const socket = window.io(SOCKET_URL, {\n                query: { token },\n                autoConnect: true,\n                reconnection: true,\n                reconnectionDelay: 1000,\n                reconnectionAttempts: 10,\n                timeout: 20000,\n                transports: [\"websocket\", \"polling\"],\n            })\n\n            socketRef.current = socket\n\n            socket.on(\"connect\", () => {\n                setIsConnected(true)\n                setError(\"\")\n            })\n\n            socket.on(\"disconnect\", () => {\n                setIsConnected(false)\n            })\n\n            socket.on(\"connect_error\", () => {\n                setError(\"Kh√¥ng th·ªÉ k·∫øt n·ªëi socket\")\n                setIsConnected(false)\n            })\n\n            socket.on(\"reconnect_attempt\", () => {\n                // Reconnecting...\n            })\n\n            socket.on(\"reconnect\", () => {\n                setIsConnected(true)\n                setError(\"\")\n            })\n\n            socket.on(\"connected\", () => {\n                // Connected event received\n            })\n\n            // Chat events\n            socket.on(\"message_sent\", (data) => {\n                if (messageCallbacksRef.current.onMessageSent) {\n                    messageCallbacksRef.current.onMessageSent(data)\n                }\n            })\n\n            socket.on(\"message_received\", (data) => {\n                if (messageCallbacksRef.current.onMessageReceived) {\n                    messageCallbacksRef.current.onMessageReceived(data)\n                }\n            })\n\n            socket.on(\"user_typing\", () => {\n                // User typing event\n            })\n\n            socket.on(\"message_error\", (error) => {\n                const err = error as { message?: string }\n                setError(err?.message || \"L·ªói khi g·ª≠i tin nh·∫Øn\")\n            })\n\n            socket.on(\"auth_error\", () => {\n                setError(\"L·ªói x√°c th·ª±c. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.\")\n            })\n\n            // Call events\n            socket.on(\"call:initiated\", (data) => {\n                console.log(\"‚úÖ Received call:initiated event:\", data)\n                if (callCallbacksRef.current.onCallInitiated) {\n                    callCallbacksRef.current.onCallInitiated(data)\n                }\n            })\n\n            socket.on(\"call:incoming\", (data) => {\n                console.log(\"üìû Received call:incoming event:\", data)\n                if (callCallbacksRef.current.onIncomingCall) {\n                    callCallbacksRef.current.onIncomingCall(data)\n                }\n            })\n\n            socket.on(\"call:answered\", (data) => {\n                console.log(\"‚úÖ Received call:answered event:\", data)\n                if (callCallbacksRef.current.onCallAnswered) {\n                    callCallbacksRef.current.onCallAnswered(data)\n                }\n            })\n\n            socket.on(\"call:rejected\", (data) => {\n                if (callCallbacksRef.current.onCallRejected) {\n                    callCallbacksRef.current.onCallRejected(data)\n                }\n            })\n\n            socket.on(\"call:ended\", (data) => {\n                if (callCallbacksRef.current.onCallEnded) {\n                    callCallbacksRef.current.onCallEnded(data)\n                }\n            })\n\n            socket.on(\"call:failed\", (data) => {\n                if (callCallbacksRef.current.onCallFailed) {\n                    callCallbacksRef.current.onCallFailed(data)\n                }\n            })\n\n            socket.on(\"webrtc:offer\", (data) => {\n                if (callCallbacksRef.current.onWebRTCOffer) {\n                    callCallbacksRef.current.onWebRTCOffer(data)\n                }\n            })\n\n            socket.on(\"webrtc:answer\", (data) => {\n                if (callCallbacksRef.current.onWebRTCAnswer) {\n                    callCallbacksRef.current.onWebRTCAnswer(data)\n                }\n            })\n\n            socket.on(\"webrtc:ice-candidate\", (data) => {\n                if (callCallbacksRef.current.onICECandidate) {\n                    callCallbacksRef.current.onICECandidate(data)\n                }\n            })\n        }\n\n        script.onerror = () => {\n            setError(\"Kh√¥ng th·ªÉ t·∫£i th∆∞ vi·ªán Socket.IO\")\n        }\n\n        document.head.appendChild(script)\n\n        return () => {\n            if (socketRef.current) {\n                socketRef.current.off(\"connect\")\n                socketRef.current.off(\"disconnect\")\n                socketRef.current.off(\"connect_error\")\n                socketRef.current.off(\"reconnect_attempt\")\n                socketRef.current.off(\"reconnect\")\n                socketRef.current.off(\"connected\")\n                socketRef.current.off(\"message_sent\")\n                socketRef.current.off(\"message_received\")\n                socketRef.current.off(\"user_typing\")\n                socketRef.current.off(\"message_error\")\n                socketRef.current.off(\"auth_error\")\n                socketRef.current.off(\"call:initiated\")\n                socketRef.current.off(\"call:incoming\")\n                socketRef.current.off(\"call:answered\")\n                socketRef.current.off(\"call:rejected\")\n                socketRef.current.off(\"call:ended\")\n                socketRef.current.off(\"call:failed\")\n                socketRef.current.off(\"webrtc:offer\")\n                socketRef.current.off(\"webrtc:answer\")\n                socketRef.current.off(\"webrtc:ice-candidate\")\n\n                socketRef.current.disconnect()\n                socketRef.current = null\n            }\n\n            if (script.parentNode) {\n                script.parentNode.removeChild(script)\n            }\n        }\n    }, [])\n\n    const sendMessage = useCallback((messageData: unknown): boolean => {\n        if (!socketRef.current || !isConnected) {\n            return false\n        }\n\n        try {\n            socketRef.current.emit(\"send_message\", messageData)\n            return true\n        } catch {\n            return false\n        }\n    }, [isConnected])\n\n    const sendTypingIndicator = useCallback((conversationId: string, isTyping: boolean): void => {\n        if (!socketRef.current || !isConnected) {\n            return\n        }\n\n        try {\n            socketRef.current.emit(\"typing\", { conversationId, isTyping })\n        } catch {\n            // Error sending typing indicator\n        }\n    }, [isConnected])\n\n    const initiateCall = useCallback((callData: unknown): boolean => {\n        if (!socketRef.current || !isConnected) {\n            console.error(\"‚ùå Socket not connected or socketRef is null\")\n            return false\n        }\n\n        try {\n            console.log(\"üì° Emitting call:initiate event:\", callData)\n            socketRef.current.emit(\"call:initiate\", callData)\n            return true\n        } catch (error) {\n            console.error(\"‚ùå Error emitting call:initiate:\", error)\n            return false\n        }\n    }, [isConnected])\n\n    const answerCall = useCallback((callId: string): boolean => {\n        if (!socketRef.current || !isConnected) {\n            return false\n        }\n\n        try {\n            socketRef.current.emit(\"call:answer\", { callId })\n            return true\n        } catch {\n            return false\n        }\n    }, [isConnected])\n\n    const rejectCall = useCallback((callId: string): boolean => {\n        if (!socketRef.current || !isConnected) {\n            return false\n        }\n\n        try {\n            socketRef.current.emit(\"call:reject\", { callId })\n            return true\n        } catch {\n            return false\n        }\n    }, [isConnected])\n\n    const endCall = useCallback((callId: string): boolean => {\n        if (!socketRef.current || !isConnected) {\n            return false\n        }\n\n        try {\n            socketRef.current.emit(\"call:end\", { callId })\n            return true\n        } catch {\n            return false\n        }\n    }, [isConnected])\n\n    const sendWebRTCOffer = useCallback((toUserId: string, offer: unknown): boolean => {\n        if (!socketRef.current || !isConnected) {\n            return false\n        }\n\n        try {\n            socketRef.current.emit(\"webrtc:offer\", { to: toUserId, offer })\n            return true\n        } catch {\n            return false\n        }\n    }, [isConnected])\n\n    const sendWebRTCAnswer = useCallback((toUserId: string, answer: unknown): boolean => {\n        if (!socketRef.current || !isConnected) {\n            return false\n        }\n\n        try {\n            socketRef.current.emit(\"webrtc:answer\", { to: toUserId, answer })\n            return true\n        } catch {\n            return false\n        }\n    }, [isConnected])\n\n    const sendICECandidate = useCallback((toUserId: string, candidate: unknown): boolean => {\n        if (!socketRef.current || !isConnected) {\n            return false\n        }\n\n        try {\n            socketRef.current.emit(\"webrtc:ice-candidate\", { to: toUserId, candidate })\n            return true\n        } catch {\n            return false\n        }\n    }, [isConnected])\n\n    const contextValue = useMemo<SocketContextValue>(() => ({\n        socket: socketRef.current,\n        isConnected,\n        error,\n        sendMessage,\n        sendTypingIndicator,\n        registerMessageCallbacks,\n        initiateCall,\n        answerCall,\n        rejectCall,\n        endCall,\n        sendWebRTCOffer,\n        sendWebRTCAnswer,\n        sendICECandidate,\n        registerCallCallbacks,\n    }), [\n        isConnected,\n        error,\n        sendMessage,\n        sendTypingIndicator,\n        registerMessageCallbacks,\n        initiateCall,\n        answerCall,\n        rejectCall,\n        endCall,\n        sendWebRTCOffer,\n        sendWebRTCAnswer,\n        sendICECandidate,\n        registerCallCallbacks,\n    ])\n\n    return (\n        <SocketContext.Provider value={contextValue}>\n            {children}\n        </SocketContext.Provider>\n    )\n}\n\nexport const useSocket = (): SocketContextValue => {\n    const context = useContext(SocketContext)\n    if (!context) {\n        throw new Error(\"useSocket must be used within SocketProvider\")\n    }\n    return context\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 556, "column": 0}, "map": {"version":3,"sources":["file:///home/neuro/Documents/Blur/frontend/src/contexts/NotificationContext.tsx"],"sourcesContent":["'use client'\n\nimport React, { createContext, useContext, useState, useCallback, useMemo, ReactNode } from \"react\"\nimport { X } from \"lucide-react\"\nimport { useRouter } from \"next/navigation\"\n\n// ===== TYPES =====\nexport interface NotificationData {\n    id: string\n    senderName?: string\n    senderFirstName?: string\n    senderLastName?: string\n    avatar?: string\n    senderImageUrl?: string\n    message?: string\n    content?: string\n    createdDate?: string\n    timestamp?: string\n    type?: string\n    seen?: boolean\n    read?: boolean\n    postId?: string\n    senderId?: string\n    onClick?: (notification: NotificationItem) => void\n}\n\nexport interface NotificationItem {\n    id: string\n    senderName: string\n    senderFirstName?: string\n    senderLastName?: string\n    avatar?: string\n    message?: string\n    createdDate: string\n    type: string\n    seen: boolean\n    postId?: string\n    senderId?: string\n    onClick?: (notification: NotificationItem) => void\n}\n\ninterface NotificationContextValue {\n    notifications: NotificationItem[]\n    addNotification: (notificationData: NotificationData) => void\n    removeNotification: (notificationId: string) => void\n    setNotificationsList: (list: NotificationItem[]) => void\n    setMode: (mode: \"toast\" | \"silent\") => void\n    mode: \"toast\" | \"silent\"\n    notificationCounter: number\n}\n\ninterface NotificationProviderProps {\n    children: ReactNode\n}\n\ninterface MessageToastProps {\n    notification: NotificationItem\n    onClose: (id: string) => void\n    onClick: (notification: NotificationItem) => void\n}\n\n// ===== CONTEXT =====\nconst NotificationContext = createContext<NotificationContextValue | null>(null)\n\nexport const useNotification = (): NotificationContextValue => {\n    const context = useContext(NotificationContext)\n    if (!context) {\n        throw new Error(\"useNotification must be used within NotificationProvider\")\n    }\n    return context\n}\n\nexport const requestNotificationPermission = async (): Promise<boolean> => {\n    if (typeof window === 'undefined') return false\n    if (!(\"Notification\" in window)) {\n        console.log(\"Browser kh√¥ng h·ªó tr·ª£ notification\")\n        return false\n    }\n\n    if (Notification.permission === \"granted\") return true\n    if (Notification.permission !== \"denied\") {\n        const permission = await Notification.requestPermission()\n        return permission === \"granted\"\n    }\n    return false\n}\n\n// ===== TOAST COMPONENT =====\nconst MessageToast: React.FC<MessageToastProps> = ({ notification, onClose, onClick }) => {\n    const displayName = useMemo(() => {\n        if (notification.senderName && notification.senderName !== \"Unknown User\") {\n            return notification.senderName\n        }\n\n        const firstName = notification.senderFirstName || \"\"\n        const lastName = notification.senderLastName || \"\"\n        const fullName = `${firstName} ${lastName}`.trim()\n\n        return fullName || \"Unknown User\"\n    }, [\n        notification.senderFirstName,\n        notification.senderLastName,\n        notification.senderName,\n    ])\n\n    const handleClick = () => {\n        onClick(notification)\n        onClose(notification.id)\n    }\n\n    return (\n        <div\n            onClick={handleClick}\n            className=\"w-[320px] bg-white rounded-xl shadow-lg border border-sky-100 p-3 cursor-pointer hover:shadow-xl hover:-translate-y-0.5 transition-all duration-200\"\n        >\n            <div className=\"flex items-start gap-3\">\n                {/* Avatar */}\n                <img\n                    src={\n                        notification.avatar ||\n                        \"https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_640.png\"\n                    }\n                    alt={displayName}\n                    className=\"w-10 h-10 rounded-full object-cover border border-sky-200 flex-shrink-0\"\n                />\n\n                {/* N·ªôi dung */}\n                <div className=\"flex-1 min-w-0\">\n                    {/* D√≤ng ch√≠nh: T√™n + message */}\n                    <p className=\"text-sm text-gray-800 leading-snug\">\n                        <span className=\"font-semibold mr-1\">{displayName}</span>\n                        {notification.message || \"ƒë√£ g·ª≠i m·ªôt th√¥ng b√°o cho b·∫°n.\"}\n                    </p>\n\n                    {/* Th·ªùi gian */}\n                    <p className=\"text-xs text-gray-400 mt-1\">\n                        {formatTime(notification.createdDate)}\n                    </p>\n\n                    {/* Click ƒë·ªÉ xem */}\n                    {notification.postId && (\n                        <p className=\"text-xs text-sky-600 font-medium mt-1\">\n                            Click ƒë·ªÉ xem ‚Üí\n                        </p>\n                    )}\n                </div>\n\n                {/* N√∫t ƒë√≥ng */}\n                <button\n                    onClick={(e) => {\n                        e.stopPropagation()\n                        onClose(notification.id)\n                    }}\n                    className=\"ml-1 text-gray-400 hover:text-gray-600\"\n                >\n                    <X size={14} />\n                </button>\n            </div>\n        </div>\n    )\n}\n\n// ===== PROVIDER =====\nexport const NotificationProvider: React.FC<NotificationProviderProps> = ({ children }) => {\n    const [notifications, setNotifications] = useState<NotificationItem[]>([])\n    const [mode, setMode] = useState<\"toast\" | \"silent\">(\"toast\")\n    const [notificationCounter, setNotificationCounter] = useState(0)\n    const router = useRouter()\n\n    const addNotification = useCallback((notificationData: NotificationData) => {\n        console.log(\"üîî Adding notification:\", notificationData)\n\n        setNotifications((prev) => {\n            if (!notificationData?.id) {\n                console.warn(\"‚ö†Ô∏è Notification missing ID\")\n                return prev\n            }\n\n            const exists = prev.some((n) => n.id === notificationData.id)\n            if (exists) {\n                console.log(\"‚ö†Ô∏è Notification already exists:\", notificationData.id)\n                return prev\n            }\n\n            const fullName = [notificationData.senderFirstName, notificationData.senderLastName]\n                .filter(Boolean)\n                .join(\" \")\n            const senderName = fullName || notificationData.senderName || \"Unknown User\"\n\n            const notification: NotificationItem = {\n                id: notificationData.id,\n                senderFirstName: notificationData.senderFirstName,\n                senderLastName: notificationData.senderLastName,\n                senderName,\n                avatar: notificationData.avatar || notificationData.senderImageUrl,\n                message: notificationData.content || notificationData.message,\n                createdDate:\n                    notificationData.createdDate ||\n                    notificationData.timestamp ||\n                    new Date().toISOString(),\n                type: notificationData.type || \"general\",\n                seen: notificationData.seen ?? notificationData.read ?? false,\n                postId: notificationData.postId,\n                senderId: notificationData.senderId,\n            }\n\n            playNotificationSound()\n            if (typeof document !== 'undefined' && document.hidden) showBrowserNotification(notification)\n            setNotificationCounter((c) => c + 1)\n\n            console.log(\"‚úÖ Notification added to state\")\n            return [notification, ...prev]\n        })\n    }, [])\n\n    const setNotificationsList = useCallback((list: NotificationItem[]) => {\n        setNotifications(list)\n    }, [])\n\n    const removeNotification = useCallback((notificationId: string) => {\n        setNotifications((prev) => prev.filter((n) => n.id !== notificationId))\n    }, [])\n\n    const handleNotificationClick = useCallback(\n        (notification: NotificationItem) => {\n            if (notification.onClick) {\n                notification.onClick(notification)\n            }\n\n            if (notification.postId) {\n                router.push(`/post/${notification.postId}`)\n            }\n\n            removeNotification(notification.id)\n        },\n        [router, removeNotification]\n    )\n\n    const value = useMemo<NotificationContextValue>(() => ({\n        notifications,\n        addNotification,\n        removeNotification,\n        setNotificationsList,\n        setMode,\n        mode,\n        notificationCounter,\n    }), [notifications, addNotification, removeNotification, setNotificationsList, mode, notificationCounter])\n\n    return (\n        <NotificationContext.Provider value={value}>\n            {children}\n            <div className=\"fixed top-4 right-4 z-[9999] space-y-3 max-h-screen overflow-y-auto pointer-events-none\">\n                <div className=\"pointer-events-auto\">\n                    {mode === \"toast\" &&\n                        notifications.map((notification) => (\n                            <MessageToast\n                                key={notification.id}\n                                notification={notification}\n                                onClose={removeNotification}\n                                onClick={handleNotificationClick}\n                            />\n                        ))}\n                </div>\n            </div>\n        </NotificationContext.Provider>\n    )\n}\n\n// ===== Helpers =====\nconst formatTime = (dateString?: string): string => {\n    if (!dateString) return \"V·ª´a xong\"\n    const date = new Date(dateString)\n    const now = new Date()\n    const diff = Math.floor((now.getTime() - date.getTime()) / 1000)\n    if (diff < 60) return \"V·ª´a xong\"\n    if (diff < 3600) return `${Math.floor(diff / 60)} ph√∫t tr∆∞·ªõc`\n    if (diff < 86400) return `${Math.floor(diff / 3600)} gi·ªù tr∆∞·ªõc`\n    return date.toLocaleTimeString(\"vi-VN\", {\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        day: \"2-digit\",\n        month: \"2-digit\",\n    })\n}\n\nconst playNotificationSound = (): void => {\n    if (typeof window === 'undefined') return\n    try {\n        const audio = new Audio(\"/notification.mp3\")\n        audio.play().catch(() => { })\n    } catch {\n        // Ignore audio errors\n    }\n}\n\nconst showBrowserNotification = (notification: NotificationItem): void => {\n    if (typeof window === 'undefined') return\n    if (\"Notification\" in window && Notification.permission === \"granted\") {\n        const n = new Notification(notification.senderName, {\n            body: notification.message,\n            icon: notification.avatar,\n        })\n        setTimeout(() => n.close(), 5000)\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 898, "column": 0}, "map": {"version":3,"sources":["file:///home/neuro/Documents/Blur/frontend/src/contexts/NotificationSocketContext.tsx"],"sourcesContent":["'use client'\n\nimport React, { createContext, useContext, useEffect, useRef, useState, ReactNode } from \"react\"\nimport { getToken } from \"@/lib/utils/auth\"\nimport { useNotification } from \"@/contexts/NotificationContext\"\n\ninterface NotificationSocketProviderProps {\n    children: ReactNode\n}\n\ninterface NotificationPayload {\n    id: string\n    senderName?: string\n    content?: string\n    senderImageUrl?: string\n    timestamp?: string\n    type?: string\n    postId?: string\n}\n\ninterface StompClient {\n    subscribe: (destination: string, callback: (message: { body: string }) => void) => void\n    activate: () => void\n    deactivate: () => void\n}\n\nconst NotificationSocketContext = createContext<StompClient | null>(null)\n\nexport const NotificationSocketProvider: React.FC<NotificationSocketProviderProps> = ({ children }) => {\n    const stompClientRef = useRef<StompClient | null>(null)\n    const [isConnected, setIsConnected] = useState(false)\n    const { addNotification } = useNotification()\n\n    useEffect(() => {\n        if (typeof window === 'undefined') return\n\n        const token = getToken()\n        if (!token) {\n            console.log(\"üìµ No token, skipping notification socket connection\")\n            return\n        }\n\n        let client: StompClient | null = null\n\n        // Lazy load sockjs-client and @stomp/stompjs to prevent module-level crash\n        const initSocket = async () => {\n            try {\n                console.log(\"üîå Loading notification socket libraries...\")\n\n                // Dynamic imports to prevent blank page issue\n                const [{ Client }, { default: SockJS }] = await Promise.all([\n                    import(\"@stomp/stompjs\"),\n                    import(\"sockjs-client\")\n                ])\n\n                // Decode token to get userId\n                const payload = token.split('.')[1]\n                const decoded = JSON.parse(atob(payload))\n                const userId = decoded.sub\n\n                console.log(\"üë§ Connecting notification socket for userId:\", userId)\n\n                client = new Client({\n                    webSocketFactory: () =>\n                        new SockJS(\n                            `http://localhost:8082/notification/ws-notification?token=${token}`\n                        ) as WebSocket,\n                    connectHeaders: {\n                        Authorization: `Bearer ${token}`,\n                    },\n                    reconnectDelay: 5000,\n                    debug: (str) => console.log(\"[STOMP]\", str),\n\n                    onConnect: () => {\n                        console.log(\"‚úÖ Connected to /ws-notification\")\n                        setIsConnected(true)\n\n                        client?.subscribe(`/user/${userId}/notification`, (message) => {\n                            try {\n                                const data: NotificationPayload = JSON.parse(message.body)\n                                console.log(\"üîî Realtime notification received:\", data)\n\n                                addNotification({\n                                    id: data.id,\n                                    senderName: data.senderName,\n                                    message: data.content,\n                                    avatar: data.senderImageUrl,\n                                    createdDate: data.timestamp,\n                                    type: data.type || \"general\",\n                                    postId: data.postId,\n                                    seen: false,\n                                })\n                            } catch (e) {\n                                console.error(\"‚ùå Failed to parse notification message:\", e)\n                            }\n                        })\n                    },\n\n                    onStompError: (frame) => {\n                        console.error(\"‚ùå STOMP Error:\", frame.headers[\"message\"])\n                        setIsConnected(false)\n                    },\n\n                    onDisconnect: () => {\n                        console.log(\"üì¥ Disconnected from notification socket\")\n                        setIsConnected(false)\n                    },\n                }) as StompClient\n\n                client.activate()\n                stompClientRef.current = client\n\n            } catch (error) {\n                console.error(\"‚ùå Failed to initialize notification socket:\", error)\n                // Don't crash the app - just log the error\n            }\n        }\n\n        initSocket()\n\n        return () => {\n            if (client) {\n                try {\n                    client.deactivate()\n                } catch (e) {\n                    console.error(\"Error deactivating notification socket:\", e)\n                }\n            }\n        }\n    }, [addNotification])\n\n    return (\n        <NotificationSocketContext.Provider value={stompClientRef.current}>\n            {children}\n        </NotificationSocketContext.Provider>\n    )\n}\n\nexport const useNotificationSocket = (): StompClient | null =>\n    useContext(NotificationSocketContext)\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AACA;;;AAJA;;;;AA0BA,MAAM,0CAA4B,IAAA,8KAAa,EAAqB;AAE7D,MAAM,6BAAwE,CAAC,EAAE,QAAQ,EAAE;;IAC9F,MAAM,iBAAiB,IAAA,uKAAM,EAAqB;IAClD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,6JAAe;IAE3C,IAAA,0KAAS;gDAAC;YACN;;YAEA,MAAM,QAAQ,IAAA,0IAAQ;YACtB,IAAI,CAAC,OAAO;gBACR,QAAQ,GAAG,CAAC;gBACZ;YACJ;YAEA,IAAI,SAA6B;YAEjC,2EAA2E;YAC3E,MAAM;mEAAa;oBACf,IAAI;wBACA,QAAQ,GAAG,CAAC;wBAEZ,8CAA8C;wBAC9C,MAAM,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,SAAS,MAAM,EAAE,CAAC,GAAG,MAAM,QAAQ,GAAG,CAAC;;;yBAG3D;wBAED,6BAA6B;wBAC7B,MAAM,UAAU,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE;wBACnC,MAAM,UAAU,KAAK,KAAK,CAAC,KAAK;wBAChC,MAAM,SAAS,QAAQ,GAAG;wBAE1B,QAAQ,GAAG,CAAC,iDAAiD;wBAE7D,SAAS,IAAI,OAAO;4BAChB,gBAAgB;mFAAE,IACd,IAAI,OACA,CAAC,yDAAyD,EAAE,OAAO;;4BAE3E,gBAAgB;gCACZ,eAAe,CAAC,OAAO,EAAE,OAAO;4BACpC;4BACA,gBAAgB;4BAChB,KAAK;mFAAE,CAAC,MAAQ,QAAQ,GAAG,CAAC,WAAW;;4BAEvC,SAAS;mFAAE;oCACP,QAAQ,GAAG,CAAC;oCACZ,eAAe;oCAEf,QAAQ,UAAU,CAAC,MAAM,EAAE,OAAO,aAAa,CAAC;2FAAE,CAAC;4CAC/C,IAAI;gDACA,MAAM,OAA4B,KAAK,KAAK,CAAC,QAAQ,IAAI;gDACzD,QAAQ,GAAG,CAAC,sCAAsC;gDAElD,gBAAgB;oDACZ,IAAI,KAAK,EAAE;oDACX,YAAY,KAAK,UAAU;oDAC3B,SAAS,KAAK,OAAO;oDACrB,QAAQ,KAAK,cAAc;oDAC3B,aAAa,KAAK,SAAS;oDAC3B,MAAM,KAAK,IAAI,IAAI;oDACnB,QAAQ,KAAK,MAAM;oDACnB,MAAM;gDACV;4CACJ,EAAE,OAAO,GAAG;gDACR,QAAQ,KAAK,CAAC,2CAA2C;4CAC7D;wCACJ;;gCACJ;;4BAEA,YAAY;mFAAE,CAAC;oCACX,QAAQ,KAAK,CAAC,kBAAkB,MAAM,OAAO,CAAC,UAAU;oCACxD,eAAe;gCACnB;;4BAEA,YAAY;mFAAE;oCACV,QAAQ,GAAG,CAAC;oCACZ,eAAe;gCACnB;;wBACJ;wBAEA,OAAO,QAAQ;wBACf,eAAe,OAAO,GAAG;oBAE7B,EAAE,OAAO,OAAO;wBACZ,QAAQ,KAAK,CAAC,+CAA+C;oBAC7D,2CAA2C;oBAC/C;gBACJ;;YAEA;YAEA;wDAAO;oBACH,IAAI,QAAQ;wBACR,IAAI;4BACA,OAAO,UAAU;wBACrB,EAAE,OAAO,GAAG;4BACR,QAAQ,KAAK,CAAC,2CAA2C;wBAC7D;oBACJ;gBACJ;;QACJ;+CAAG;QAAC;KAAgB;IAEpB,qBACI,6LAAC,0BAA0B,QAAQ;QAAC,OAAO,eAAe,OAAO;kBAC5D;;;;;;AAGb;GA5Ga;;QAGmB,6JAAe;;;KAHlC;AA8GN,MAAM,wBAAwB;;IACjC,OAAA,IAAA,2KAAU,EAAC;AAAyB;IAD3B"}},
    {"offset": {"line": 1048, "column": 0}, "map": {"version":3,"sources":["file:///home/neuro/Documents/Blur/frontend/src/components/providers/ClientProviders.tsx"],"sourcesContent":["'use client'\n\nimport { ReactNode } from 'react'\nimport { ChakraProvider, createSystem, defaultConfig } from '@chakra-ui/react'\nimport { SocketProvider } from '@/contexts/SocketContext'\nimport { NotificationProvider } from '@/contexts/NotificationContext'\nimport { NotificationSocketProvider } from '@/contexts/NotificationSocketContext'\nimport { Toaster } from 'react-hot-toast'\n\ninterface ClientProvidersProps {\n    children: ReactNode\n}\n\nconst system = createSystem(defaultConfig)\n\nexport function ClientProviders({ children }: ClientProvidersProps) {\n    return (\n        <ChakraProvider value={system}>\n            <SocketProvider>\n                <NotificationProvider>\n                    <NotificationSocketProvider>\n                        {children}\n                        <Toaster\n                            position=\"top-right\"\n                            toastOptions={{\n                                duration: 5000,\n                                style: {\n                                    borderRadius: '12px',\n                                    background: '#fff',\n                                    color: '#333',\n                                    boxShadow: '0 10px 40px rgba(0, 0, 0, 0.1)',\n                                },\n                            }}\n                        />\n                    </NotificationSocketProvider>\n                </NotificationProvider>\n            </SocketProvider>\n        </ChakraProvider>\n    )\n}\n\n"],"names":[],"mappings":";;;;;AAGA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAPA;;;;;;;AAaA,MAAM,SAAS,IAAA,uMAAY,EAAC,oLAAa;AAElC,SAAS,gBAAgB,EAAE,QAAQ,EAAwB;IAC9D,qBACI,6LAAC,2MAAc;QAAC,OAAO;kBACnB,cAAA,6LAAC,sJAAc;sBACX,cAAA,6LAAC,kKAAoB;0BACjB,cAAA,6LAAC,8KAA0B;;wBACtB;sCACD,6LAAC,qKAAO;4BACJ,UAAS;4BACT,cAAc;gCACV,UAAU;gCACV,OAAO;oCACH,cAAc;oCACd,YAAY;oCACZ,OAAO;oCACP,WAAW;gCACf;4BACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;AAO5B;KAxBgB"}}]
}