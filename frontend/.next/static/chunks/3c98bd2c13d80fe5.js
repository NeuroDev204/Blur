(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,40141,e=>{"use strict";var t=e.i(71645),s={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},r=t.default.createContext&&t.default.createContext(s),a=["attr","size","title"];function n(){return(n=Object.assign.bind()).apply(this,arguments)}function i(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,r)}return s}function l(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?i(Object(s),!0).forEach(function(t){var r,a,n;r=e,a=t,n=s[t],(a=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(a))in r?Object.defineProperty(r,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[a]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):i(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function o(e){return s=>t.default.createElement(c,n({attr:l({},e.attr)},s),function e(s){return s&&s.map((s,r)=>t.default.createElement(s.tag,l({key:r},s.attr),e(s.child)))}(e.child))}function c(e){var i=s=>{var r,{attr:i,size:o,title:c}=e,d=function(e,t){if(null==e)return{};var s,r,a=function(e,t){if(null==e)return{};var s={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;s[r]=e[r]}return s}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)s=n[r],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(a[s]=e[s])}return a}(e,a),m=o||s.size||"1em";return s.className&&(r=s.className),e.className&&(r=(r?r+" ":"")+e.className),t.default.createElement("svg",n({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,i,d,{className:r,style:l(l({color:e.color||s.color},s.style),e.style),height:m,width:m,xmlns:"http://www.w3.org/2000/svg"}),c&&t.default.createElement("title",null,c),e.children)};return void 0!==r?t.default.createElement(r.Consumer,null,e=>i(e)):i(s)}e.s(["GenIcon",()=>o],40141)},64152,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(18566),a=e.i(5766),n=e.i(42094),i=e.i(21151),l=e.i(67051),o=e.i(55324);let c=async()=>(await o.default.get("/chat/conversations/my-conversations")).data,d=async(e,t)=>(await o.default.post("/chat/messages/create",{conversationId:e,message:t})).data,m=async(e,t=0,s=50)=>(await o.default.get(`/chat/conversations/${e}/messages`,{params:{page:t,size:s}})).data,u=async e=>{try{return(await o.default.put(`/chat/conversations/mark-as-read?conversationId=${e}`,{})).data}catch{return null}};var h=e.i(57339),x=e.i(94983);let f=({conv:e,isSelected:s,unreadCount:r,onClick:a})=>(0,t.jsxs)("div",{onClick:a,className:`flex items-center gap-3 p-4 cursor-pointer hover:bg-gray-50 transition-all duration-200 ${s?"bg-gradient-to-r from-sky-50 to-blue-50 border-r-4 border-sky-500":""} ${r>0?"bg-sky-50/50":""}`,children:[(0,t.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,t.jsx)("img",{src:e.conversationAvatar||"https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_640.png",alt:"Avatar",className:"w-12 h-12 rounded-full object-cover border-2 border-white shadow-sm"}),r>0&&(0,t.jsx)("div",{className:"absolute -top-1 -right-1 min-w-[20px] h-5 flex items-center justify-center bg-gradient-to-r from-red-500 to-pink-500 text-white text-xs font-bold rounded-full px-1",children:r>99?"99+":r})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsx)("p",{className:`font-semibold text-gray-800 truncate ${r>0?"text-sky-800":""}`,children:e.conversationName||"Conversation"}),(0,t.jsx)("span",{className:"text-xs text-gray-400 flex-shrink-0 ml-2",children:(e=>{if(!e)return"";let t=new Date(e),s=Math.floor((new Date().getTime()-t.getTime())/1e3);return s<60?"Now":s<3600?`${Math.floor(s/60)}m`:s<86400?`${Math.floor(s/3600)}h`:t.toLocaleDateString()})(e.lastMessageTime)})]}),(0,t.jsx)("p",{className:`text-sm truncate ${r>0?"text-gray-700 font-medium":"text-gray-500"}`,children:e.lastMessage||"No messages yet"})]})]}),g=({conversations:e,selectedChat:r,onSelectChat:a,isLoading:n=!1,unreadByConversation:i={}})=>{let l=(0,s.useMemo)(()=>[...e].sort((e,t)=>{let s=i[e.id]||0,r=i[t.id]||0;if(s>0&&0===r)return -1;if(r>0&&0===s)return 1;let a=e.lastMessageTime?new Date(e.lastMessageTime).getTime():0;return(t.lastMessageTime?new Date(t.lastMessageTime).getTime():0)-a}),[e,i]);return n?(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:Array.from({length:5}).map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-4 animate-pulse",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-32 mb-2"}),(0,t.jsx)("div",{className:"h-3 bg-gray-100 rounded w-48"})]})]},`skeleton-${s}`))}):0===l.length?(0,t.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center p-6 text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 mb-4 rounded-full bg-gradient-to-br from-sky-100 to-blue-100 flex items-center justify-center",children:(0,t.jsx)(x.MessageCircle,{className:"w-8 h-8 text-sky-400"})}),(0,t.jsx)("h3",{className:"font-semibold text-gray-800 mb-1",children:"No conversations yet"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Start a conversation with someone!"})]}):(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:l.map(e=>(0,t.jsx)(f,{conv:e,isSelected:r?.id===e.id,unreadCount:i[e.id]||0,onClick:()=>a(e)},e.id))})};var y=e.i(75254);let p=(0,y.default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),b=(0,y.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),v=(0,y.default)("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),j=({message:e,isOwn:s})=>{var r;let a=e.message||e.content||"";return(0,t.jsx)("div",{className:`flex ${s?"justify-end":"justify-start"}`,children:(0,t.jsxs)("div",{className:`max-w-[70%] px-4 py-2.5 rounded-2xl ${s?"bg-gradient-to-r from-sky-500 to-blue-500 text-white rounded-br-sm":"bg-white text-gray-800 shadow-sm border border-gray-100 rounded-bl-sm"}`,children:[(0,t.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:a}),(0,t.jsxs)("p",{className:`text-xs mt-1.5 ${s?"text-white/70":"text-gray-400"}`,children:[(r=e.createdDate||e.createdAt)?new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",s&&e.read&&(0,t.jsx)("span",{className:"ml-2",children:"✓✓"})]})]})})},w=({conversation:e,messages:r,currentUserId:a,onSendMessage:n,isConnected:i=!1,loadingMessages:l=!1})=>{let[o,c]=(0,s.useState)(""),d=(0,s.useRef)(null);(0,s.useEffect)(()=>{d.current?.scrollIntoView({behavior:"smooth"})},[r]);let m=()=>{o.trim()&&(n(o.trim()),c(""))};return e?(0,t.jsxs)("div",{className:"flex-1 flex flex-col bg-gray-50",children:[(0,t.jsxs)("div",{className:"bg-white p-4 border-b flex items-center gap-3 shadow-sm",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("img",{src:e.conversationAvatar||"https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_640.png",alt:"Avatar",className:"w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm"}),i&&(0,t.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-semibold text-gray-800",children:e.conversationName||"Conversation"}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:i?"Online":"Offline"})]})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[l?(0,t.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-sky-500 border-t-transparent rounded-full mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"Loading messages..."})]})}):r.length>0?r.map(e=>(0,t.jsx)(j,{message:e,isOwn:e.senderId===a},e.id)):(0,t.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-gray-500",children:"No messages yet"}),(0,t.jsx)("p",{className:"text-gray-400 text-sm",children:"Start the conversation!"})]})}),(0,t.jsx)("div",{ref:d})]}),(0,t.jsx)("div",{className:"bg-white p-4 border-t",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{className:"p-2 hover:bg-gray-100 rounded-full transition-colors text-gray-500 hover:text-gray-700",children:(0,t.jsx)(b,{size:20})}),(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsx)("input",{type:"text",placeholder:"Type a message...",value:o,onChange:e=>c(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),m())},className:"w-full px-4 py-3 pr-12 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all bg-gray-50"}),(0,t.jsx)("button",{className:"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 hover:bg-gray-100 rounded-full transition-colors text-gray-500 hover:text-gray-700",children:(0,t.jsx)(v,{size:18})})]}),(0,t.jsx)("button",{onClick:m,disabled:!o.trim(),className:"p-3 bg-gradient-to-r from-sky-500 to-blue-500 text-white rounded-full hover:from-sky-600 hover:to-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md hover:shadow-lg",children:(0,t.jsx)(p,{size:20})})]})})]}):(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center bg-gradient-to-b from-gray-50 to-white",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-br from-sky-100 to-blue-100 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-12 h-12 text-sky-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,t.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"Select a conversation"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"Choose a chat to start messaging"})]})})},N=(0,y.default)("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),k=(0,y.default)("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),M=({isConnected:e})=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:`w-2 h-2 rounded-full ${e?"bg-green-500":"bg-red-500"}`}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:e?"Connected":"Disconnected"}),e?(0,t.jsx)(N,{size:14,className:"text-green-500"}):(0,t.jsx)(k,{size:14,className:"text-red-500"})]});function O(){let[e,o]=(0,s.useState)([]),[x,f]=(0,s.useState)(null),[y,p]=(0,s.useState)([]),[b,v]=(0,s.useState)(null),[j,N]=(0,s.useState)(!1),[k,O]=(0,s.useState)(!0),[C,S]=(0,s.useState)(!1),[T,E]=(0,s.useState)(!1),[z,P]=(0,s.useState)({}),D=(0,r.useRouter)(),{sendMessage:L,isConnected:$,registerMessageCallbacks:I}=(0,i.useSocket)(),{addNotification:A}=(0,l.useNotification)();(0,s.useEffect)(()=>{(0,n.isAuthenticated)()||D.push("/login")},[D]),(0,s.useEffect)(()=>{let e=()=>{S(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{(0,l.requestNotificationPermission)()},[]),(0,s.useEffect)(()=>{v((0,n.getUserId)())},[]);let K=(0,s.useCallback)(async()=>{try{O(!0);let e=(await c()||[]).sort((e,t)=>{let s=e.lastMessageTime?new Date(e.lastMessageTime).getTime():0;return(t.lastMessageTime?new Date(t.lastMessageTime).getTime():0)-s});o(e)}catch(e){console.error("Error fetching conversations:",e),a.default.error("Không thể tải danh sách trò chuyện")}finally{O(!1)}},[]);(0,s.useEffect)(()=>{(0,n.getToken)()&&K()},[K]);let B=(0,s.useCallback)(async e=>{try{N(!0);let t=await m(e,0,50),s=t?.content||[];p(s.reverse()),await u(e),P(t=>({...t,[e]:0}))}catch(e){console.error("Error fetching messages:",e)}finally{N(!1)}},[]);(0,s.useEffect)(()=>{I&&I({onMessageReceived:e=>{x&&e.conversationId===x.id?p(t=>[...t,e]):P(t=>({...t,[e.conversationId||""]:(t[e.conversationId||""]||0)+1})),K()},onMessageSent:e=>{p(t=>[...t,e])}})},[I,x,K]);let R=async e=>{if(e.trim()&&x?.id)try{L({conversationId:x.id,message:e})||(await d(x.id,e),B(x.id))}catch(e){console.error("Error sending message:",e),a.default.error("Không thể gửi tin nhắn")}};return(0,t.jsxs)("div",{className:"flex min-h-screen",children:[C&&(0,t.jsx)("button",{onClick:()=>E(!T),className:"fixed top-4 left-4 z-50 p-2 bg-white rounded-md shadow-md border md:hidden","aria-label":"Toggle menu",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:T?(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),C&&T&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden",onClick:()=>E(!1)}),(0,t.jsx)("div",{className:"hidden md:block w-[240px] h-screen bg-white border-r flex-shrink-0",children:(0,t.jsx)(h.SidebarComponent,{})}),(0,t.jsx)("div",{className:`
                    md:hidden fixed top-0 left-0 w-64 h-screen bg-white border-r z-50
                    transition-transform duration-300 ease-in-out
                    ${T?"translate-x-0":"-translate-x-full"}
                `,children:(0,t.jsx)(h.SidebarComponent,{})}),(0,t.jsx)("div",{className:`flex-1 min-h-screen w-full max-w-full overflow-hidden ${C?"pt-16":""}`,children:(0,t.jsxs)("div",{className:"flex h-screen",children:[(0,t.jsxs)("div",{className:"w-80 bg-white border-r flex flex-col",children:[(0,t.jsxs)("div",{className:"p-4 border-b",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"Messages"}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(M,{isConnected:$})})]}),(0,t.jsx)(g,{conversations:e,selectedChat:x,onSelectChat:e=>{f(e),e.id&&B(e.id)},isLoading:k,unreadByConversation:z})]}),(0,t.jsx)(w,{conversation:x,messages:y,currentUserId:b,onSendMessage:R,isConnected:$,loadingMessages:j})]})})]})}e.s(["default",()=>O],64152)}]);